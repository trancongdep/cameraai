<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VDC Safety AI v1.13</title>
    <script src="https://cdn.jsdelivr.net/npm/onnxruntime-web/dist/ort.min.js"></script>
    <style>
        body { font-family: sans-serif; margin: 0; background: #0f172a; color: white; text-align: center; }
        .app-bar { background: #1e40af; padding: 15px; font-weight: bold; }
        #cam-box { width: 100%; max-width: 400px; margin: 20px auto; position: relative; background: #000; border-radius: 15px; overflow: hidden; }
        video, canvas { width: 100%; display: block; }
        .error-log { color: #f87171; background: #450a0a; margin: 10px; padding: 10px; border-radius: 8px; font-size: 12px; display: none; }
    </style>
</head>
<body>

<div class="app-bar">VDC SAFETY AI - V1.13</div>

<div id="cam-box">
    <video id="webcam" autoplay playsinline muted></video>
    <canvas id="overlay"></canvas>
</div>

<div id="error-box" class="error-log"></div>

<div id="status" style="margin-top: 15px; font-size: 14px;">
    Đang kiểm tra tệp tin ppe.onnx...
</div>

<script>
    async function init() {
        const status = document.getElementById('status');
        const errorBox = document.getElementById('error-box');

        try {
            // Kiểm tra dung lượng file trước khi nạp
            const response = await fetch('./ppe.onnx', { method: 'HEAD' });
            const size = response.headers.get('content-length');
            
            if (size < 1000) {
                throw new Error("File quá nhỏ (" + size + " bytes). Có thể GitHub LFS chưa đẩy file thật lên.");
            }

            status.innerText = "Đang nạp mô hình AI (" + (size / (1024*1024)).toFixed(1) + " MB)...";
            
            // Nạp mô hình
            const session = await ort.InferenceSession.create('./ppe.onnx', { 
                executionProviders: ['wasm'],
                graphOptimizationLevel: 'all'
            });
            
            status.innerText = "● HỆ THỐNG SẴN SÀNG";
            status.style.color = "#4ade80";

            const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
            document.getElementById('webcam').srcObject = stream;

        } catch (e) {
            status.innerText = "Lỗi hệ thống (V1.13)";
            errorBox.style.display = "block";
            errorBox.innerText = e.message + "\n\nGợi ý: Hãy kiểm tra xem file ppe.onnx trên GitHub có đúng 87MB không.";
        }
    }
    init();
</script>
</body>
</html>
